<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interdi√ß√µes de Vias ‚Äì Ub√° MG</title>

    <!-- Meta tags for SEO & Sharing -->
    <meta name="description"
        content="Acompanhe o mapa em tempo real das interdi√ß√µes de vias, pontes e estradas em Ub√°-MG causadas pelas fortes chuvas de fevereiro de 2026. Atualiza√ß√µes da Defesa Civil e PMRv.">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css?v=3">
</head>

<body>
    <div class="app-container">

        <!-- Sidebar -->
        <aside class="sidebar">
            <header class="sidebar-header">
                <div class="warning-badge">
                    <span class="pulse-dot"></span>
                    <span>Alerta Ativo</span>
                </div>
                <h1>Interdi√ß√µes de Vias</h1>
                <p class="subtitle">Ub√° ‚Äì MG | Chuvas de 2026</p>
                <p class="description">
                    Mapa de monitoramento da mobilidade em Ub√°. Acompanhe os pontos de interdi√ß√£o total e parcial
                    informados pela Defesa Civil, PMRv e not√≠cias locais.
                </p>
            </header>

            <div class="auth-section-wrapper"
                style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
                <div id="auth-section">
                    <p style="font-size: 0.85rem; color: #cbd5e1; margin-bottom: 10px;">Fa√ßa login com o Google para
                        reportar √°reas afetadas ou solicitar ajuda.</p>
                    <a href="/auth/google" class="btn-google" style="display: block; text-align: center;">Entrar com
                        Google</a>
                </div>

                <div id="user-info-section" style="display: none;">
                    <div class="user-info" style="justify-content: space-between; margin-bottom: 0;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <img id="user-avatar" src="" alt="Avatar"
                                style="width: 32px; height: 32px; border-radius: 50%;">
                            <span id="user-name" style="font-size: 0.85rem; font-weight: bold;"></span>
                        </div>
                        <a href="/auth/logout" class="btn-logout"
                            style="padding: 5px 10px; font-size: 0.75rem;">Sair</a>
                    </div>
                </div>
            </div>

            <div class="legend-section">
                <h3>Legenda do Mapa</h3>
                <ul class="legend-list">
                    <li><span class="legend-color color-total"></span><span class="legend-text">Interdi√ß√£o Total</span>
                    </li>
                    <li><span class="legend-color color-parcial"></span><span class="legend-text">Interdi√ß√£o
                            Parcial</span></li>
                    <li><span class="legend-color color-bridge"></span><span class="legend-text">Ponte com
                            Risco/Colapsada</span></li>
                    <li><span class="legend-color color-doacao"></span><span class="legend-text">Ponto de Doa√ß√£o
                            üçÄ</span></li>
                    <li><span class="legend-color" style="background:#8b5cf6;"></span><span class="legend-text">Fam√≠lia
                            com Necessidade üÜò</span></li>
                </ul>
            </div>

            <div class="community-feed" id="forms-container" style="display: none;">
                <!-- Painel Admin -->
                <div id="admin-panel"
                    style="display: none; padding: 15px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; margin-bottom: 20px;">
                    <h3
                        style="color: #60a5fa; font-size: 0.9rem; margin-top: 0; margin-bottom: 10px; display: flex; align-items: center; gap: 5px;">
                        <span style="font-size: 1.1rem;">üëë</span> PAINEL ADMINISTRATIVO</h3>
                    <div style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 10px;">Gest√£o de Logradouros Oficial
                    </div>
                    <form id="add-street-form" style="display: flex; flex-direction: column; gap: 8px;">
                        <input type="text" id="new-street-name" placeholder="Nome da Rua (Ex: Pra√ßa Guido)" required
                            style="padding: 8px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 4px; font-size: 0.8rem;">
                        <button type="submit"
                            style="padding: 8px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">Cadastrar
                            Via</button>
                    </form>
                    <hr style="border: 0; height: 1px; background: rgba(255,255,255,0.1); margin: 15px 0;">
                    <form id="delete-street-form" style="display: flex; flex-direction: column; gap: 8px;">
                        <input type="text" id="delete-street-id" placeholder="ID da Rua para excluir" required
                            style="padding: 8px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 4px; font-size: 0.8rem;">
                        <button type="submit"
                            style="padding: 8px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">Excluir
                            Via</button>
                    </form>
                    <div id="big-boss-only-section" style="display: none;">
                        <hr style="border: 0; height: 1px; background: rgba(255,255,255,0.1); margin: 15px 0;">
                        <form id="add-admin-form" style="display: flex; flex-direction: column; gap: 8px;">
                            <input type="email" id="new-admin-email" placeholder="E-mail Gmail do Oficial" required
                                style="padding: 8px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 4px; font-size: 0.8rem;">
                            <button type="submit"
                                style="padding: 8px; background: #fbbf24; color: #000; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; font-weight: bold;">Conceder
                                Admin üëë</button>
                        </form>
                    </div>
                </div>

                <!-- Formul√°rios Divididos -->
                <div class="forms-split" style="display: flex; flex-direction: column; gap: 20px;">

                    <!-- BLOCO 1: Interdi√ß√µes -->
                    <div class="form-block"
                        style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.3);">
                        <h3 style="color: #fca5a5; margin-top: 0; margin-bottom: 15px;">üöß √Åreas Alagadas / Interdi√ß√µes
                        </h3>
                        <form id="street-report-form-danger">
                            <label for="street-search-danger">Logradouro:</label>
                            <div style="position: relative; margin-bottom: 10px;">
                                <input type="text" id="street-search-danger" placeholder="Busque a rua..."
                                    autocomplete="off" required>
                                <div id="street-dropdown-danger" class="dropdown-list"></div>
                            </div>
                            <input type="hidden" id="selected-street-id-danger">

                            <label for="status-select-danger">Situa√ß√£o:</label>
                            <select id="status-select-danger" required style="margin-bottom: 10px;">
                                <option value="">Selecione o alerta...</option>
                                <option value="total">Interdi√ß√£o Total</option>
                                <option value="parcial">Interdi√ß√£o Parcial / √Ågua Secando</option>
                                <option value="bridge">Ponte com Risco</option>
                            </select>

                            <button type="submit" class="btn-submit" style="background: #ef4444;">Marcar
                                Interdi√ß√£o</button>
                        </form>
                    </div>

                    <!-- BLOCO 2: Ajuda -->
                    <div class="form-block"
                        style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.3);">
                        <h3 style="color: #6ee7b7; margin-top: 0; margin-bottom: 15px;">ü§ù Coleta e Fam√≠lias</h3>
                        <form id="street-report-form-help">
                            <label for="street-search-help">Logradouro:</label>
                            <div style="position: relative; margin-bottom: 10px;">
                                <input type="text" id="street-search-help" placeholder="Busque a rua..."
                                    autocomplete="off" required>
                                <div id="street-dropdown-help" class="dropdown-list"></div>
                            </div>
                            <input type="hidden" id="selected-street-id-help">

                            <label for="status-select-help">Tipo de Ajuda:</label>
                            <select id="status-select-help" required style="margin-bottom: 10px;"
                                onchange="document.getElementById('family-fields').style.display = this.value === 'need_help' ? 'block' : 'none'">
                                <option value="">Selecione o tipo...</option>
                                <option value="doacao">Ponto de Coleta/Doa√ß√£o üçÄ</option>
                                <option value="need_help">Fam√≠lias com Necessidade üÜò</option>
                            </select>

                            <div id="family-fields" style="display: none; margin-bottom: 10px;">
                                <label for="family-name">Nome do Respons√°vel (Opcional):</label>
                                <input type="text" id="family-name" placeholder="Ex: Maria" style="margin-bottom: 5px;">
                                <label for="family-phone">Telefone / Pix (Opcional):</label>
                                <input type="text" id="family-phone" placeholder="Ex: (32) 99999-9999">
                            </div>

                            <button type="submit" class="btn-submit" style="background: #10b981;">Registrar
                                Ponto</button>
                        </form>
                    </div>

                </div>

                <!-- Shared Visual Marker Logic -->
                <div id="marker-instruction"
                    style="display:none; color:var(--accent); font-weight:bold; font-size:0.85rem; padding: 10px 0; line-height:1.4; margin-top: 15px;">
                    üó∫Ô∏è Modo de Sele√ß√£o Ativo: Clique no mapa para marcar o ponto exato da rua selecionada (m√°x 3).
                </div>
                <ul id="selected-points-list"
                    style="list-style:none; padding:0; font-size:0.8rem; margin-bottom:10px; color:#9ca3af;"></ul>
            </div>

            <div class="emergency-contacts">
                <h3>Telefones √öteis</h3>
                <ul>
                    <li>Defesa Civil: <strong>199</strong></li>
                    <li>Corpo de Bombeiros: <strong>193</strong></li>
                    <li>Pol√≠cia Militar: <strong>190</strong></li>
                    <li>Pol√≠cia Militar Rodovi√°ria (PMRv): <strong>198</strong></li>
                </ul>
            </div>

            <div class="sources-section">
                <h3>Fontes de Consulta</h3>
                <div class="source-buttons">
                    <a href="https://www.instagram.com/professorjosedamato/" target="_blank" rel="noopener"
                        class="btn-source">Prefeito Prof. Jos√© Damato</a>
                    <a href="https://www.instagram.com/ubaprefeitura/" target="_blank" rel="noopener"
                        class="btn-source">Pref. Ub√° (Instagram)</a>
                    <a href="https://www.uba.mg.gov.br/materias" target="_blank" rel="noopener" class="btn-source">Pref.
                        Ub√° (Site Oficial)</a>
                    <a href="https://www.policiamilitar.mg.gov.br/" target="_blank" rel="noopener"
                        class="btn-source">Pol√≠cia Militar MG</a>
                    <a href="http://www.defesacivil.mg.gov.br/" target="_blank" rel="noopener" class="btn-source">Defesa
                        Civil MG</a>
                </div>
            </div>

            <footer class="sidebar-footer">
                <p>Atualizado pela √∫ltima vez: <span id="last-updated">26/02/2026 21:00</span></p>
                <p class="disclaimer">Sempre siga as orienta√ß√µes locais antes de sair de casa.</p>
            </footer>
        </aside>

        <!-- Main Content Area -->
        <main class="map-area">
            <div id="uba-map"></div>
        </main>

    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Custom JS -->
    <script src="app.js?v=3"></script>
</body>

</html>